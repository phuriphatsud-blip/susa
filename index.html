<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SOS Tasugete</title>
  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-4">

  <h1 class="text-center text-danger mb-3">üö® SOS Tasugete</h1>

  <!-- ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà -->
  <div id="locationBox" class="alert alert-warning text-center fw-bold">
    üìç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...
  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏ó‡∏£‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô -->
  <div id="buttonGroup" class="d-grid gap-3 mb-3">
    <button class="btn btn-success btn-lg" onclick="confirmCall('üè• ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•', '1669')">üè• ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (1669)</button>
    <button class="btn btn-primary btn-lg" onclick="confirmCall('üëÆ‚Äç‚ôÇÔ∏è ‡∏ï‡∏≥‡∏£‡∏ß‡∏à', '191')">üëÆ‚Äç‚ôÇÔ∏è ‡∏ï‡∏≥‡∏£‡∏ß‡∏à (191)</button>
    <button class="btn btn-danger btn-lg" onclick="confirmCall('üî• ‡πÑ‡∏ü‡πÑ‡∏´‡∏°‡πâ / ‡∏î‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏¥‡∏á', '199')">üî• ‡πÑ‡∏ü‡πÑ‡∏´‡∏°‡πâ / ‡∏î‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏¥‡∏á (199)</button>
    <button class="btn btn-warning btn-lg" onclick="confirmCall('üêç ‡∏á‡∏π‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô / ‡∏Å‡∏π‡πâ‡∏†‡∏±‡∏¢', '1784')">üêç ‡∏á‡∏π‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô / ‡∏Å‡∏π‡πâ‡∏†‡∏±‡∏¢ (1784)</button>
    <button class="btn btn-info btn-lg" onclick="confirmCall('üõ£Ô∏è ‡∏ï‡∏≥‡∏£‡∏ß‡∏à‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏ß‡∏á', '1193')">üõ£Ô∏è ‡∏ï‡∏≥‡∏£‡∏ß‡∏à‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏ß‡∏á (1193)</button>
  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô -->
  <button class="btn btn-danger btn-lg mb-3" onclick="openModal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</button>

  <!-- ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÇ‡∏ó‡∏£‡πÅ‡∏ö‡∏ö‡∏ã‡πà‡∏≠‡∏ô -->
  <a id="hiddenCallLink" style="display:none;"></a>

  <!-- Modal ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô -->
  <div class="modal fade" id="emergencyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content p-3">
        <h5 class="modal-title text-danger">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</h5>
        <input id="emergencyName" class="form-control my-2" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô">
        <input id="emergencyNumber" class="form-control my-2" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">
        <div class="d-flex gap-2 justify-content-end">
          <button class="btn btn-secondary" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button class="btn btn-danger" onclick="addEmergency()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="text-center text-secondary mt-4 small">
    ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ ‚Äî ‡πÇ‡∏ó‡∏£‡∏ü‡∏£‡∏µ 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
  </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
function confirmCall(name, number) {
  if(confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏ó‡∏£‡πÑ‡∏õ‡∏¢‡∏±‡∏á ${name} ‡πÄ‡∏ö‡∏≠‡∏£‡πå ${number} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
    const link = document.getElementById("hiddenCallLink");
    link.href = `tel:${number}`;
    link.click();
  }
}

// Modal control
const modal = new bootstrap.Modal(document.getElementById('emergencyModal'));
function openModal() { modal.show(); }
function closeModal() { modal.hide(); }

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô
function addEmergency() {
  const name = document.getElementById('emergencyName').value.trim();
  const number = document.getElementById('emergencyNumber').value.trim();
  if(!name || !number){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'); return; }

  const btn = document.createElement('button');
  btn.className = 'btn btn-secondary btn-lg';
  btn.textContent = `${name} (${number})`;
  btn.onclick = () => confirmCall(name, number);
  document.getElementById('buttonGroup').appendChild(btn);

  closeModal();
  document.getElementById('emergencyName').value = '';
  document.getElementById('emergencyNumber').value = '';
}

// ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
async function showLocation() {
  const box = document.getElementById("locationBox");
  if (!navigator.geolocation) {
    box.className = "alert alert-danger text-center fw-bold";
    box.innerText = "‚ùó ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á";
    return;
  }

  navigator.geolocation.getCurrentPosition(async pos => {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;

    try {
      const res = await fetch(`/reverse?lat=${lat}&lon=${lon}`);
      const data = await res.json();

      const addr = data.address || {};
      const number = addr.house_number || "";
      const road = addr.road || "";
      const subdistrict = addr.suburb || addr.subdistrict || "";
      const district = addr.county || addr.district || "";
      const state = addr.state || "";
      const postcode = addr.postcode || "";

      box.className = "alert alert-success text-center fw-bold";
      box.innerHTML = `üìç ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà: <b>${number} ${road}, ${subdistrict}, ${district}, ${state} ${postcode}</b>`;
    } catch {
      box.className = "alert alert-danger text-center fw-bold";
      box.innerText = "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏î‡πâ (CORS ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï)";
    }
  }, err => {
    box.className = "alert alert-danger text-center fw-bold";
    box.innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ: " + err.message;
  });
}

window.addEventListener("load", showLocation);
</script>
</body>
</html>
